// WorldCards.org Translations
const WORLDCARDS_TRANSLATIONS = {
    fr: {
        // Navigation
        home: "Accueil",
        categories: "Catégories",
        sell: "Vendre",
        about: "À propos",
        contact: "Contact",
        login: "Connexion",
        register: "Inscription",
        
        // Search
        search_placeholder: "Rechercher une carte, un personnage, une équipe...",
        search: "Rechercher",
        
        // Hero
        hero_title: "La plateforme mondiale des cartes collection",
        hero_subtitle: "Connectez-vous à une communauté globale de collectionneurs. Pokémon, Football, Hockey - Votre marché mondial.",
        
        // Sections
        our_categories: "Explorez le Monde des Cartes",
        featured_cards: "Cartes Mondiales en Vedette",
        about_us: "À propos de WorldCards",
        about_text: "WorldCards.org est la plateforme mondiale pour les collectionneurs de cartes. Authenticité garantie, communauté globale.",
        
        // Categories
        pokemon: "Pokémon",
        football: "Football",
        clubs: "Clubs",
        moments: "Moments",
        collection: "Collection",
        hockey: "Hockey",
        
        // Actions
        add_to_cart: "Ajouter au panier",
        view_details: "Voir détails",
        buy_now: "Acheter maintenant",
        add_to_wishlist: "Ajouter aux favoris",
        
        // Filters
        filter_all: "Tous",
        filter_new: "Nouveautés",
        filter_popular: "Populaires",
        filter_expensive: "Prix élevé",
        filter_cheap: "Prix bas",
        
        // Countries
        country_france: "France",
        country_usa: "États-Unis",
        country_russia: "Russie",
        country_china: "Chine",
        country_brazil: "Brésil",
        country_argentina: "Argentine",
        country_italy: "Italie",
        country_spain: "Espagne",
        country_germany: "Allemagne",
        country_japan: "Japon",
        
        // Messages
        welcome_message: "Bienvenue sur WorldCards.org",
        cart_empty: "Votre panier est vide",
        loading: "Chargement...",
        success: "Succès!",
        error: "Erreur",
        
        // Months
        month_jan: "Janvier",
        month_feb: "Février",
        month_mar: "Mars",
        month_apr: "Avril",
        month_may: "Mai",
        month_jun: "Juin",
        month_jul: "Juillet",
        month_aug: "Août",
        month_sep: "Septembre",
        month_oct: "Octobre",
        month_nov: "Novembre",
        month_dec: "Décembre"
    },
    
    en: {
        home: "Home",
        categories: "Categories",
        sell: "Sell",
        about: "About",
        contact: "Contact",
        login: "Login",
        register: "Register",
        
        search_placeholder: "Search for a card, character, team...",
        search: "Search",
        
        hero_title: "The global platform for collectible cards",
        hero_subtitle: "Connect with a global community of collectors. Pokémon, Football, Hockey - Your worldwide marketplace.",
        
        our_categories: "Explore the World of Cards",
        featured_cards: "Featured World Cards",
        about_us: "About WorldCards",
        about_text: "WorldCards.org is the global platform for card collectors. Authenticity guaranteed, global community.",
        
        pokemon: "Pokémon",
        football: "Football",
        clubs: "Clubs",
        moments: "Moments",
        collection: "Collection",
        hockey: "Hockey",
        
        add_to_cart: "Add to Cart",
        view_details: "View Details",
        buy_now: "Buy Now",
        add_to_wishlist: "Add to Wishlist",
        
        filter_all: "All",
        filter_new: "New",
        filter_popular: "Popular",
        filter_expensive: "Expensive",
        filter_cheap: "Cheap",
        
        country_france: "France",
        country_usa: "USA",
        country_russia: "Russia",
        country_china: "China",
        country_brazil: "Brazil",
        country_argentina: "Argentina",
        country_italy: "Italy",
        country_spain: "Spain",
        country_germany: "Germany",
        country_japan: "Japan",
        
        welcome_message: "Welcome to WorldCards.org",
        cart_empty: "Your cart is empty",
        loading: "Loading...",
        success: "Success!",
        error: "Error"
    },
    
    ru: {
        home: "Главная",
        categories: "Категории",
        sell: "Продать",
        about: "О нас",
        contact: "Контакты",
        login: "Войти",
        register: "Регистрация",
        
        search_placeholder: "Поиск карты, персонажа, команды...",
        search: "Поиск",
        
        hero_title: "Глобальная платформа коллекционных карт",
        hero_subtitle: "Присоединяйтесь к глобальному сообществу коллекционеров. Покемон, Футбол, Хоккей - Ваш мировой рынок.",
        
        our_categories: "Исследуйте Мир Карт",
        featured_cards: "Рекомендуемые Карты Мира",
        about_us: "О WorldCards",
        about_text: "WorldCards.org - глобальная платформа для коллекционеров карт. Гарантия подлинности, глобальное сообщество.",
        
        pokemon: "Покемон",
        football: "Футбол",
        clubs: "Клубы",
        moments: "Моменты",
        collection: "Коллекция",
        hockey: "Хоккей",
        
        add_to_cart: "Добавить в корзину",
        view_details: "Подробнее",
        buy_now: "Купить сейчас",
        add_to_wishlist: "В избранное",
        
        filter_all: "Все",
        filter_new: "Новые",
        filter_popular: "Популярные",
        filter_expensive: "Дорогие",
        filter_cheap: "Дешевые",
        
        country_france: "Франция",
        country_usa: "США",
        country_russia: "Россия",
        country_china: "Китай",
        country_brazil: "Бразилия",
        country_argentina: "Аргентина",
        country_italy: "Италия",
        country_spain: "Испания",
        country_germany: "Германия",
        country_japan: "Япония",
        
        welcome_message: "Добро пожаловать на WorldCards.org",
        cart_empty: "Ваша корзина пуста",
        loading: "Загрузка...",
        success: "Успех!",
        error: "Ошибка"
    },
    
    zh: {
        home: "首页",
        categories: "分类",
        sell: "出售",
        about: "关于",
        contact: "联系",
        login: "登录",
        register: "注册",
        
        search_placeholder: "搜索卡片、角色、球队...",
        search: "搜索",
        
        hero_title: "全球收藏卡交易平台",
        hero_subtitle: "连接全球收藏家社区。宝可梦、足球、冰球 - 您的全球市场。",
        
        our_categories: "探索卡片世界",
        featured_cards: "特色全球卡片",
        about_us: "关于WorldCards",
        about_text: "WorldCards.org 是全球收藏卡平台。保证真品，全球社区。",
        
        pokemon: "宝可梦",
        football: "足球",
        clubs: "俱乐部",
        moments: "时刻",
        collection: "收藏",
        hockey: "冰球",
        
        add_to_cart: "加入购物车",
        view_details: "查看详情",
        buy_now: "立即购买",
        add_to_wishlist: "加入收藏夹",
        
        filter_all: "全部",
        filter_new: "新款",
        filter_popular: "热门",
        filter_expensive: "高价",
        filter_cheap: "低价",
        
        country_france: "法国",
        country_usa: "美国",
        country_russia: "俄罗斯",
        country_china: "中国",
        country_brazil: "巴西",
        country_argentina: "阿根廷",
        country_italy: "意大利",
        country_spain: "西班牙",
        country_germany: "德国",
        country_japan: "日本",
        
        welcome_message: "欢迎来到WorldCards.org",
        cart_empty: "您的购物车是空的",
        loading: "加载中...",
        success: "成功!",
        error: "错误"
    }
};

// Language Management
class WorldCardsLanguage {
    constructor() {
        this.currentLang = 'fr';
        this.loadLanguage();
    }
    
    loadLanguage() {
        // Try to get saved language from localStorage
        const savedLang = localStorage.getItem('worldcards_lang');
        if (savedLang && WORLDCARDS_TRANSLATIONS[savedLang]) {
            this.currentLang = savedLang;
        }
        
        // Update language selector
        const selector = document.getElementById('languageSelect');
        if (selector) {
            selector.value = this.currentLang;
        }
        
        // Apply translations
        this.applyTranslations();
    }
    
    applyTranslations() {
        // Update all elements with data-lang-key
        document.querySelectorAll('[data-lang-key]').forEach(element => {
            const key = element.getAttribute('data-lang-key');
            const translation = this.getTranslation(key);
            
            if (translation) {
                if (element.tagName === 'INPUT' && element.type === 'text') {
                    element.placeholder = translation;
                } else if (element.tagName === 'INPUT' && element.type === 'textarea') {
                    element.placeholder = translation;
                } else {
                    element.textContent = translation;
                }
            }
        });
        
        // Update page title and meta
        this.updatePageMetadata();
    }
    
    getTranslation(key) {
        const translations = WORLDCARDS_TRANSLATIONS[this.currentLang];
        return translations ? translations[key] : null;
    }
    
    updatePageMetadata() {
        // Update page title
        const title = this.getTranslation('hero_title');
        if (title) {
            document.title = `WorldCards.org - ${title}`;
        }
        
        // Update meta description
        const description = this.getTranslation('hero_subtitle');
        const metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc && description) {
            metaDesc.content = description;
        }
    }
    
    changeLanguage(langCode) {
        if (WORLDCARDS_TRANSLATIONS[langCode]) {
            this.currentLang = langCode;
            localStorage.setItem('worldcards_lang', langCode);
            this.applyTranslations();
            
            // Dispatch language change event
            document.dispatchEvent(new CustomEvent('languageChanged', {
                detail: { language: langCode }
            }));
            
            return true;
        }
        return false;
    }
    
    getCurrentLanguage() {
        return this.currentLang;
    }
    
    getAvailableLanguages() {
        return Object.keys(WORLDCARDS_TRANSLATIONS);
    }
    
    getLanguageName(langCode) {
        const names = {
            fr: "Français",
            en: "English",
            ru: "Русский",
            zh: "中文"
        };
        return names[langCode] || langCode;
    }
}

// Currency Management
class WorldCardsCurrency {
    constructor() {
        this.currentCurrency = 'EUR';
        this.exchangeRates = {
            EUR: 1,
            USD: 1.08,
            RUB: 98.5
        };
        this.loadCurrency();
    }
    
    loadCurrency() {
        const savedCurrency = localStorage.getItem('worldcards_currency');
        if (savedCurrency && this.exchangeRates[savedCurrency]) {
            this.currentCurrency = savedCurrency;
        }
        
        // Update currency selector
        const selector = document.getElementById('currencySelect');
        if (selector) {
            selector.value = this.currentCurrency;
        }
        
        this.updateAllPrices();
    }
    
    convertPrice(priceInEUR) {
        const rate = this.exchangeRates[this.currentCurrency] || 1;
        const converted = priceInEUR * rate;
        
        // Format based on currency
        switch(this.currentCurrency) {
            case 'EUR':
                return `€${converted.toFixed(2)}`;
            case 'USD':
                return `$${converted.toFixed(2)}`;
            case 'RUB':
                return `₽${Math.round(converted)}`;
            default:
                return `€${converted.toFixed(2)}`;
        }
    }
    
    getCurrencySymbol() {
        switch(this.currentCurrency) {
            case 'EUR': return '€';
            case 'USD': return '$';
            case 'RUB': return '₽';
            default: return '€';
        }
    }
    
    updateAllPrices() {
        // Update all price elements
        document.querySelectorAll('.product-price, .player-price, .pokemon-card-price, .club-card-price, .moment-card-price').forEach(element => {
            const priceEUR = element.getAttribute('data-price-eur');
            if (priceEUR) {
                const price = parseFloat(priceEUR);
                const converted = this.convertPrice(price);
                element.innerHTML = `${converted} <span class="currency">${this.currentCurrency}</span>`;
            }
        });
    }
    
    changeCurrency(currencyCode) {
        if (this.exchangeRates[currencyCode]) {
            this.currentCurrency = currencyCode;
            localStorage.setItem('worldcards_currency', currencyCode);
            this.updateAllPrices();
            
            // Dispatch currency change event
            document.dispatchEvent(new CustomEvent('currencyChanged', {
                detail: { currency: currencyCode }
            }));
            
            return true;
        }
        return false;
    }
    
    getCurrentCurrency() {
        return this.currentCurrency;
    }
}

// Initialize Language and Currency systems
let WorldCardsLang = null;
let WorldCardsCurr = null;

document.addEventListener('DOMContentLoaded', function() {
    // Initialize language system
    WorldCardsLang = new WorldCardsLanguage();
    WorldCardsCurr = new WorldCardsCurrency();
    
    // Set up language selector
    const langSelect = document.getElementById('languageSelect');
    if (langSelect) {
        langSelect.addEventListener('change', function() {
            WorldCardsLang.changeLanguage(this.value);
        });
    }
    
    // Set up currency selector
    const currSelect = document.getElementById('currencySelect');
    if (currSelect) {
        currSelect.addEventListener('change', function() {
            WorldCardsCurr.changeCurrency(this.value);
        });
    }
    
    // Make available globally
    window.WorldCardsLang = WorldCardsLang;
    window.WorldCardsCurr = WorldCardsCurr;
});
